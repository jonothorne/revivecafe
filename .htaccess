# Enable Rewrite Engine
RewriteEngine On
RewriteBase /

# Force www (optional - uncomment if you want www)
# RewriteCond %{HTTP_HOST} ^revive-cafe\.co\.uk [NC]
# RewriteRule ^(.*)$ https://www.revive-cafe.co.uk/$1 [L,R=301]

# Remove trailing slashes from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]

# Default index file
DirectoryIndex index.php index.html

# Blog post clean URLs: /blog/post/slug-name -> /blog/post.php?slug=slug-name
RewriteRule ^blog/post/([a-z0-9-]+)/?$ blog/post.php?slug=$1 [L,QSA]

# Ensure /blog/ goes to /blog/index.php
RewriteRule ^blog/?$ blog/index.php [L]

# Remove .php extension from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.*)$ $1.php [L]

# Redirect old .html files to new structure
RewriteRule ^index\.html$ index.php [R=301,L]
RewriteRule ^blog/index\.html$ blog/index.php [R=301,L]
RewriteRule ^blog/([a-z0-9-]+)\.html$ blog/post/$1 [R=301,L]

# Security: Prevent access to sensitive files
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent directory browsing
Options -Indexes

# Protect blog-data directory
<FilesMatch "\.json$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Enable gzip compression for better performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser caching for static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
</IfModule>

# Error pages (optional - create these files if you want custom error pages)
# ErrorDocument 404 /404.php
# ErrorDocument 500 /500.php
